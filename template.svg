<?xml version="1.0" encoding="utf-8"?>
<!-- Jinja2-based SVG template.
    Expects variables: LABEL_WIDTH_MM, LABEL_HEIGHT_MM, name, description, icon_svg, qr_svg
-->
{%- set LABEL_WIDTH_MM = LABEL_WIDTH_MM | default(36) %}
{%- set LABEL_HEIGHT_MM = LABEL_HEIGHT_MM | default(9) %}
{%- set name_font_size = LABEL_HEIGHT_MM * 0.15 %}
{%- set desc_font_size = LABEL_HEIGHT_MM * 0.12 %}

<svg xmlns="http://www.w3.org/2000/svg" width="{{ LABEL_WIDTH_MM }}mm" height="{{ LABEL_HEIGHT_MM }}mm" viewBox="0 0 {{ LABEL_WIDTH_MM }} {{ LABEL_HEIGHT_MM }}" preserveAspectRatio="none">

  <style>
    .bg { fill: white; }
    .icon { fill: black; }
    .name { font-family: "Roboto", sans-serif; font-size: {{ name_font_size }}mm; font-weight: 700; fill: #000000; overflow: hidden; text-overflow: ellipsis; }
    .desc { font-family: "Roboto", sans-serif; font-size: {{ desc_font_size }}mm; fill: #000000; overflow: hidden; text-overflow: ellipsis; }
  </style>

  <!-- Background -->
  <rect class="bg" x="0" y="0" width="{{ LABEL_WIDTH_MM }}" height="{{ LABEL_HEIGHT_MM }}" rx="0" ry="0"/>

  <!-- Icon area (left) -->
  {##
  Incoming icons are assumed to be 100x100, and are scaled to fit within icon_size x icon_size mm area.
  Scaling and placement rules:
  - If both top and side icons are provided:
    - the top-view icon is scaled to 60% size and placed in upper 60% of icon area, centered horizontally
    - the side-view icon is rotated 90 degrees CCW and placed below in the lower 40% of icon area, centered horizontally
  - If only one icon is provided:
    - it is scaled to fit the available icon area (100% of height) and centered vertically and horizontally

  In all cases, the icon area is a square of size LABEL_HEIGHT_MM x LABEL_HEIGHT_MM on the left side of the label.
  A viewBox of 0 0 100 100 is assumed for the incoming SVG icons.
  viewBox origin is at top-left corner, and y increases downward, x to the right
  A viewBox is used to constrain the icon drawing area, providing scaling and clipping as needed.
  ##}
  {%- if side_icon_svg and top_icon_svg %}
  {## dual icon view ##}
  <!-- top view icon -->
  <g transform="translate({{ LABEL_HEIGHT_MM * 0.5 }}, {{ LABEL_HEIGHT_MM * 0.3 }} ) scale( {{ LABEL_HEIGHT_MM * 0.6 / 100 }} ) translate(-50, -50)">
      {{ top_icon_svg | safe }}
  </g>
  <!-- side view icon -->
  <g transform="translate({{ LABEL_HEIGHT_MM * 0.5 }}, {{ LABEL_HEIGHT_MM * 0.8 }} ) scale( {{ LABEL_HEIGHT_MM * 0.75 / 100 }} ) rotate(-90, 0, 0) translate(-50, -50)">
      {{ side_icon_svg | safe }}
  </g>
  {%- elif top_icon_svg or side_icon_svg %}
  {## single icon view ##}
  <g transform="translate({{ LABEL_HEIGHT_MM * 0.5 }}, {{ LABEL_HEIGHT_MM * 0.5 }} ) scale( {{ LABEL_HEIGHT_MM * 0.9 / 100 }} ) translate(-50, -50)">
      {%- if top_icon_svg %}
        {{ top_icon_svg | safe }}
      {%- else %}
        {{ side_icon_svg | safe }}
      {%- endif %}
  </g>
  {%- endif %}

  <!-- Name & description area (middle) -->
  {%- set text_x_offset = LABEL_HEIGHT_MM if top_icon_svg or side_icon_svg else 0 %}
  {%- set available_width = LABEL_WIDTH_MM - text_x_offset - LABEL_HEIGHT_MM - (LABEL_HEIGHT_MM * 0.15) %}
  {%- set name_font_size = name_font_size %}
  {%- set desc_font_size = desc_font_size %}
  {%- set name_max_scale = available_width / (name_font_size * 15) %}
  {%- set desc_max_scale = available_width / (desc_font_size * 20) %}
  {%- set name_scale = name_max_scale if name_max_scale  < 1 else 1 %}
  {%- set desc_scale = desc_max_scale if desc_max_scale < 1 else 1 %}
  <g transform="translate({{ text_x_offset * 1.05}}, {{ LABEL_HEIGHT_MM * 0.25 }})">
    <text class="name" x="0" y="0" dominant-baseline="middle" transform="scale({{ name_scale }})">{{ name }}</text>
    <text class="desc" x="0" y="{{ LABEL_HEIGHT_MM * 0.50 }}" dominant-baseline="middle" transform="scale({{ desc_scale }})">{{ description }}</text>
  </g>

  <!-- QR area (right) -->
  {%- set qr_height = qr_size %}
  {%- set qr_width = qr_height %}
  {%- set qr_scale = LABEL_HEIGHT_MM / qr_height %}
  {%- set qr_x = LABEL_WIDTH_MM - (qr_width * qr_scale) %}
  {%- set qr_y = 0 %}
  <g transform="translate({{ qr_x }}, {{ qr_y }}), scale( {{ qr_scale }} )">
    {{ qr_svg | safe }}
  </g>

</svg>
<?xml version="1.0" encoding="utf-8"?>
<!-- Jinja2-based SVG template.
    Expects variables: LABEL_WIDTH_MM, LABEL_HEIGHT_MM, name, description, icon_svg, qr_svg
-->
{%- set LABEL_WIDTH_MM = LABEL_WIDTH_MM | default(36) %}
{%- set LABEL_HEIGHT_MM = LABEL_HEIGHT_MM | default(9) %}
{%- set name_font_size = LABEL_HEIGHT_MM * 0.15 %}
{%- set desc_font_size = LABEL_HEIGHT_MM * 0.10 %}

<svg xmlns="http://www.w3.org/2000/svg" width="{{ LABEL_WIDTH_MM }}mm" height="{{ LABEL_HEIGHT_MM }}mm" viewBox="0 0 {{ LABEL_WIDTH_MM }} {{ LABEL_HEIGHT_MM }}" preserveAspectRatio="none">

  <style>
    .bg { fill: #FFFFFF; }
    .name { font-family: "Roboto", sans-serif; font-size: {{ name_font_size }}mm; font-weight: 1000; fill: #000000; }
    .desc { font-family: "Roboto", sans-serif; font-size: {{ desc_font_size }}mm; font-weight: 300; fill: #000000; }
  </style>

  <!-- Background -->
  <rect class="bg" x="0" y="0" width="{{ LABEL_WIDTH_MM }}" height="{{ LABEL_HEIGHT_MM }}" rx="0" ry="0"/>

  <!-- Icon area (left) -->
  {##
  Incoming icons are assumed to be 100x100, and are scaled to fit within icon_size x icon_size mm area.
  Scaling and placement rules:
  - If both top and side icons are provided:
    - the top-view icon is scaled to 60% size and placed in upper 60% of icon area, centered horizontally
    - the side-view icon is rotated 90 degrees CCW and placed below in the lower 40% of icon area, centered horizontally
  - If only one icon is provided:
    - it is scaled to fit the available icon area (100% of height) and centered vertically and horizontally

  In all cases, the icon area is a square of size LABEL_HEIGHT_MM x LABEL_HEIGHT_MM on the left side of the label.
  A viewBox of 0 0 100 100 is assumed for the incoming SVG icons.
  viewBox origin is at top-left corner, and y increases downward, x to the right
  A viewBox is used to constrain the icon drawing area, providing scaling and clipping as needed.
  ##}
  {%- if side_icon_svg and top_icon_svg %}
  <g class="icon-area">
    <!-- top view icon -->
    <g transform="translate({{ LABEL_HEIGHT_MM * 0.5 }}, {{ LABEL_HEIGHT_MM * 0.3 }} ) scale( {{ LABEL_HEIGHT_MM * 0.6 / 100 }} ) translate(-50, -50)">
        {{ top_icon_svg | safe }}
    </g>
    <!-- side view icon -->
    <g transform="translate({{ LABEL_HEIGHT_MM * 0.5 }}, {{ LABEL_HEIGHT_MM * 0.8 }} ) scale( {{ LABEL_HEIGHT_MM * 0.75 / 100 }} ) rotate(-90, 0, 0) translate(-50, -50)">
        {{ side_icon_svg | safe }}
    </g>
  </g>
  {%- elif top_icon_svg or side_icon_svg %}
  <g class="icon-area">
    <!-- single icon -->
    <g transform="translate({{ LABEL_HEIGHT_MM * 0.5 }}, {{ LABEL_HEIGHT_MM * 0.5 }} ) scale( {{ LABEL_HEIGHT_MM * 0.9 / 100 }} ) translate(-50, -50)">
        {%- if top_icon_svg %}
          {{ top_icon_svg | safe }}
        {%- else %}
          {{ side_icon_svg | safe }}
        {%- endif %}
    </g>
  </g>
  {%- endif %}

  {%- set text_x_offset = LABEL_HEIGHT_MM if top_icon_svg or side_icon_svg else 0 %}
  {%- set text_box_width = (LABEL_WIDTH_MM - text_x_offset - LABEL_HEIGHT_MM) * 0.95 %}
  {%- set text_box_height = LABEL_HEIGHT_MM / 2 %}
  <g class="text-area" transform="translate({{ text_x_offset }}, {{ 0 }})">
    <svg width="{{text_box_width}}" height="{{text_box_height}}" viewBox="0 0 {{text_box_width}} {{text_box_height}}" preserveAspectRatio="xMinYMin meet">
      <text class="name" dominant-baseline="top">{{ name }}</text>
    </svg>
  </g>
  <line x1="{{ text_x_offset*0.9 }}" y1="{{ text_box_height }}" x2="{{ text_x_offset + text_box_width }}" y2="{{ text_box_height }}" stroke="#000000" stroke-width="0.2"/>
  <g class="text-area" transform="translate({{ text_x_offset }}, {{ text_box_height*1.1 }})">
    <svg width="{{text_box_width}}" height="{{text_box_height}}" viewBox="0 0 {{text_box_width}} {{text_box_height}}" preserveAspectRatio="xMinYMin meet">
      <text class="desc" dominant-baseline="top">{{ description }}</text>
    </svg>
  </g>

  <!-- QR area (right) -->
  {%- if qr_svg %}
  {%- set qr_scale = 1 / qr_size * 1.25 %}
  {%- set qr_x = LABEL_WIDTH_MM - LABEL_HEIGHT_MM %}
  {%- set qr_y = 0 %}
  <g class="qr-area" transform="translate({{ qr_x }}, {{ qr_y }})">
    <rect x="0" y="0" width="{{ LABEL_HEIGHT_MM }}" height="{{ LABEL_HEIGHT_MM }}" fill="#FFFFFF"/>
    <svg viewBox="0 0 {{ LABEL_HEIGHT_MM }} {{ LABEL_HEIGHT_MM }}" width="{{ LABEL_HEIGHT_MM }}" height="{{ LABEL_HEIGHT_MM }}" preserveAspectRatio="xMinYMin meet">
      <g transform="scale({{ qr_scale }})">
        {{ qr_svg | safe }}
      </g>
    </svg>
  </g>
  {%- endif %}

</svg>